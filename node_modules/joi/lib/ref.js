// Load modules

var Hoek = require('hoek');


// Declare internals

var internals = ***REMOVED******REMOVED***;


exports.create = function (key, options) ***REMOVED***

    Hoek.assert(typeof key === 'string', 'Invalid reference key:', key);

    var settings = Hoek.clone(options);         // options can be reused and modified

    var ref = function (value, validationOptions) ***REMOVED***

        return Hoek.reach(ref.isContext ? validationOptions.context : value, ref.key, settings);
    ***REMOVED***;

    ref.isContext = (key[0] === ((settings && settings.contextPrefix) || '$'));
    ref.key = (ref.isContext ? key.slice(1) : key);
    ref.path = ref.key.split((settings && settings.separator) || '.');
    ref.depth = ref.path.length;
    ref.root = ref.path[0];
    ref.isJoi = true;

    ref.toString = function () ***REMOVED***

        return (ref.isContext ? 'context:' : 'ref:') + ref.key;
    ***REMOVED***;

    return ref;
***REMOVED***;


exports.isRef = function (ref) ***REMOVED***

    return typeof ref === 'function' && ref.isJoi;
***REMOVED***;


exports.push = function (array, ref) ***REMOVED***

    if (exports.isRef(ref) &&
        !ref.isContext) ***REMOVED***

        array.push(ref.root);
    ***REMOVED***
***REMOVED***;
