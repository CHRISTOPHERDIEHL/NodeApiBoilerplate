"use strict";
module.exports = function(Promise, CapturedTrace, isDebugging) ***REMOVED***
var contextStack = [];
function Context() ***REMOVED***
    this._trace = new CapturedTrace(peekContext());
***REMOVED***
Context.prototype._pushContext = function () ***REMOVED***
    if (!isDebugging()) return;
    if (this._trace !== undefined) ***REMOVED***
        contextStack.push(this._trace);
    ***REMOVED***
***REMOVED***;

Context.prototype._popContext = function () ***REMOVED***
    if (!isDebugging()) return;
    if (this._trace !== undefined) ***REMOVED***
        contextStack.pop();
    ***REMOVED***
***REMOVED***;

function createContext() ***REMOVED***
    if (isDebugging()) return new Context();
***REMOVED***

function peekContext() ***REMOVED***
    var lastIndex = contextStack.length - 1;
    if (lastIndex >= 0) ***REMOVED***
        return contextStack[lastIndex];
    ***REMOVED***
    return undefined;
***REMOVED***

Promise.prototype._peekContext = peekContext;
Promise.prototype._pushContext = Context.prototype._pushContext;
Promise.prototype._popContext = Context.prototype._popContext;

return createContext;
***REMOVED***;
