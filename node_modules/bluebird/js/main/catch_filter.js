"use strict";
module.exports = function(NEXT_FILTER) ***REMOVED***
var util = require("./util.js");
var errors = require("./errors.js");
var tryCatch = util.tryCatch;
var errorObj = util.errorObj;
var keys = require("./es5.js").keys;
var TypeError = errors.TypeError;

function CatchFilter(instances, callback, promise) ***REMOVED***
    this._instances = instances;
    this._callback = callback;
    this._promise = promise;
***REMOVED***

function safePredicate(predicate, e) ***REMOVED***
    var safeObject = ***REMOVED******REMOVED***;
    var retfilter = tryCatch(predicate).call(safeObject, e);

    if (retfilter === errorObj) return retfilter;

    var safeKeys = keys(safeObject);
    if (safeKeys.length) ***REMOVED***
        errorObj.e = new TypeError("Catch filter must inherit from Error or be a simple predicate function\u000a\u000a    See http://goo.gl/o84o68\u000a");
        return errorObj;
    ***REMOVED***
    return retfilter;
***REMOVED***

CatchFilter.prototype.doFilter = function (e) ***REMOVED***
    var cb = this._callback;
    var promise = this._promise;
    var boundTo = promise._boundValue();
    for (var i = 0, len = this._instances.length; i < len; ++i) ***REMOVED***
        var item = this._instances[i];
        var itemIsErrorType = item === Error ||
            (item != null && item.prototype instanceof Error);

        if (itemIsErrorType && e instanceof item) ***REMOVED***
            var ret = tryCatch(cb).call(boundTo, e);
            if (ret === errorObj) ***REMOVED***
                NEXT_FILTER.e = ret.e;
                return NEXT_FILTER;
            ***REMOVED***
            return ret;
        ***REMOVED*** else if (typeof item === "function" && !itemIsErrorType) ***REMOVED***
            var shouldHandle = safePredicate(item, e);
            if (shouldHandle === errorObj) ***REMOVED***
                e = errorObj.e;
                break;
            ***REMOVED*** else if (shouldHandle) ***REMOVED***
                var ret = tryCatch(cb).call(boundTo, e);
                if (ret === errorObj) ***REMOVED***
                    NEXT_FILTER.e = ret.e;
                    return NEXT_FILTER;
                ***REMOVED***
                return ret;
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***
    NEXT_FILTER.e = e;
    return NEXT_FILTER;
***REMOVED***;

return CatchFilter;
***REMOVED***;
