var jwt = require('../index');
var expect = require('chai').expect;
var atob = require('atob');

describe('encoding', function() ***REMOVED***

  function b64_to_utf8 (str) ***REMOVED***
    return decodeURIComponent(escape(atob( str )));
  ***REMOVED***

  it('should properly encode the token (utf8)', function () ***REMOVED***
    var expected = 'José';
    var token = jwt.sign(***REMOVED*** name: expected ***REMOVED***, 'shhhhh');
    var decoded_name = JSON.parse(b64_to_utf8(token.split('.')[1])).name;
    expect(decoded_name).to.equal(expected);
  ***REMOVED***);

  it('should properly encode the token (binary)', function () ***REMOVED***
    var expected = 'José';
    var token = jwt.sign(***REMOVED*** name: expected ***REMOVED***, 'shhhhh', ***REMOVED*** encoding: 'binary' ***REMOVED***);
    var decoded_name = JSON.parse(atob(token.split('.')[1])).name;
    expect(decoded_name).to.equal(expected);
  ***REMOVED***);

  it('should return the same result when decoding', function () ***REMOVED***
    var username = '測試';

    var token = jwt.sign(***REMOVED***
      username: username
    ***REMOVED***, 'test');

    var payload = jwt.verify(token, 'test');

    expect(payload.username).to.equal(username);
  ***REMOVED***);

***REMOVED***);
