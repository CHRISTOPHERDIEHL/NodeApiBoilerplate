import absFloor from '../utils/abs-floor';
import ***REMOVED*** cloneWithOffset ***REMOVED*** from '../units/offset';
import ***REMOVED*** normalizeUnits ***REMOVED*** from '../units/aliases';

export function diff (input, units, asFloat) ***REMOVED***
    var that,
        zoneDelta,
        delta, output;

    if (!this.isValid()) ***REMOVED***
        return NaN;
    ***REMOVED***

    that = cloneWithOffset(input, this);

    if (!that.isValid()) ***REMOVED***
        return NaN;
    ***REMOVED***

    zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4;

    units = normalizeUnits(units);

    if (units === 'year' || units === 'month' || units === 'quarter') ***REMOVED***
        output = monthDiff(this, that);
        if (units === 'quarter') ***REMOVED***
            output = output / 3;
        ***REMOVED*** else if (units === 'year') ***REMOVED***
            output = output / 12;
        ***REMOVED***
    ***REMOVED*** else ***REMOVED***
        delta = this - that;
        output = units === 'second' ? delta / 1e3 : // 1000
            units === 'minute' ? delta / 6e4 : // 1000 * 60
            units === 'hour' ? delta / 36e5 : // 1000 * 60 * 60
            units === 'day' ? (delta - zoneDelta) / 864e5 : // 1000 * 60 * 60 * 24, negate dst
            units === 'week' ? (delta - zoneDelta) / 6048e5 : // 1000 * 60 * 60 * 24 * 7, negate dst
            delta;
    ***REMOVED***
    return asFloat ? output : absFloor(output);
***REMOVED***

function monthDiff (a, b) ***REMOVED***
    // difference in months
    var wholeMonthDiff = ((b.year() - a.year()) * 12) + (b.month() - a.month()),
        // b is in (anchor - 1 month, anchor + 1 month)
        anchor = a.clone().add(wholeMonthDiff, 'months'),
        anchor2, adjust;

    if (b - anchor < 0) ***REMOVED***
        anchor2 = a.clone().add(wholeMonthDiff - 1, 'months');
        // linear across the month
        adjust = (b - anchor) / (anchor - anchor2);
    ***REMOVED*** else ***REMOVED***
        anchor2 = a.clone().add(wholeMonthDiff + 1, 'months');
        // linear across the month
        adjust = (b - anchor) / (anchor2 - anchor);
    ***REMOVED***

    //check for negative zero, return zero if negative zero
    return -(wholeMonthDiff + adjust) || 0;
***REMOVED***
