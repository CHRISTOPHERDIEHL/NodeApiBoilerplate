/**
 * Module dependencies.
 */
//var http = require('http')
//  , req = http.IncomingMessage.prototype;


var req = exports = module.exports = ***REMOVED******REMOVED***;

/**
 * Intiate a login session for `user`.
 *
 * Options:
 *   - `session`  Save login state in session, defaults to _true_
 *
 * Examples:
 *
 *     req.logIn(user, ***REMOVED*** session: false ***REMOVED***);
 *
 *     req.logIn(user, function(err) ***REMOVED***
 *       if (err) ***REMOVED*** throw err; ***REMOVED***
 *       // session saved
 *     ***REMOVED***);
 *
 * @param ***REMOVED***User***REMOVED*** user
 * @param ***REMOVED***Object***REMOVED*** options
 * @param ***REMOVED***Function***REMOVED*** done
 * @api public
 */
req.login =
req.logIn = function(user, options, done) ***REMOVED***
  if (typeof options == 'function') ***REMOVED***
    done = options;
    options = ***REMOVED******REMOVED***;
  ***REMOVED***
  options = options || ***REMOVED******REMOVED***;
  
  var property = 'user';
  if (this._passport && this._passport.instance) ***REMOVED***
    property = this._passport.instance._userProperty || 'user';
  ***REMOVED***
  var session = (options.session === undefined) ? true : options.session;
  
  this[property] = user;
  if (session) ***REMOVED***
    if (!this._passport) ***REMOVED*** throw new Error('passport.initialize() middleware not in use'); ***REMOVED***
    if (typeof done != 'function') ***REMOVED*** throw new Error('req#login requires a callback function'); ***REMOVED***
    
    var self = this;
    this._passport.instance.serializeUser(user, this, function(err, obj) ***REMOVED***
      if (err) ***REMOVED*** self[property] = null; return done(err); ***REMOVED***
      if (!self._passport.session) ***REMOVED***
        self._passport.session = ***REMOVED******REMOVED***;
      ***REMOVED***
      self._passport.session.user = obj;
      if (!self.session) ***REMOVED***
        self.session = ***REMOVED******REMOVED***;
      ***REMOVED***
      self.session[self._passport.instance._key] = self._passport.session;
      done();
    ***REMOVED***);
  ***REMOVED*** else ***REMOVED***
    done && done();
  ***REMOVED***
***REMOVED***;

/**
 * Terminate an existing login session.
 *
 * @api public
 */
req.logout =
req.logOut = function() ***REMOVED***
  var property = 'user';
  if (this._passport && this._passport.instance) ***REMOVED***
    property = this._passport.instance._userProperty || 'user';
  ***REMOVED***
  
  this[property] = null;
  if (this._passport && this._passport.session) ***REMOVED***
    delete this._passport.session.user;
  ***REMOVED***
***REMOVED***;

/**
 * Test if request is authenticated.
 *
 * @return ***REMOVED***Boolean***REMOVED***
 * @api public
 */
req.isAuthenticated = function() ***REMOVED***
  var property = 'user';
  if (this._passport && this._passport.instance) ***REMOVED***
    property = this._passport.instance._userProperty || 'user';
  ***REMOVED***
  
  return (this[property]) ? true : false;
***REMOVED***;

/**
 * Test if request is unauthenticated.
 *
 * @return ***REMOVED***Boolean***REMOVED***
 * @api public
 */
req.isUnauthenticated = function() ***REMOVED***
  return !this.isAuthenticated();
***REMOVED***;
