var Promise = require('../')
  , Domain = require('domain').Domain
  , assert = require('assert');


describe("domains", function () ***REMOVED***
  it("exceptions should not breakout of domain boundaries", function (done) ***REMOVED***
    if (process.version.indexOf('v0.10') != 0) return done();
    var d = new Domain;
    d.on('error', function (err) ***REMOVED***
      assert.equal(err.message, 'gaga');
      done()
    ***REMOVED***);

    var p = new Promise();
    d.run(function () ***REMOVED***
      p.then(
        function () ***REMOVED******REMOVED***
      ).then(
        function () ***REMOVED*** throw new Error('gaga'); ***REMOVED***
      ).end();
    ***REMOVED***);

    process.nextTick(function () ***REMOVED***
      p.fulfill();
    ***REMOVED***);
  ***REMOVED***);
***REMOVED***);
