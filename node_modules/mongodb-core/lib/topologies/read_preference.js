"use strict";

var needSlaveOk = ['primaryPreferred', 'secondary', 'secondaryPreferred', 'nearest'];

/**
 * @fileOverview The **ReadPreference** class is a class that represents a MongoDB ReadPreference and is
 * used to construct connections.
 *
 * @example
 * var ReplSet = require('mongodb-core').ReplSet
 *   , ReadPreference = require('mongodb-core').ReadPreference
 *   , assert = require('assert');
 *
 * var server = new ReplSet([***REMOVED***host: 'localhost', port: 30000***REMOVED***], ***REMOVED***setName: 'rs'***REMOVED***);
 * // Wait for the connection event
 * server.on('connect', function(server) ***REMOVED***
 *   var cursor = server.cursor('db.test'
 *     , ***REMOVED***find: 'db.test', query: ***REMOVED******REMOVED******REMOVED***
 *     , ***REMOVED***readPreference: new ReadPreference('secondary')***REMOVED***);
 *   cursor.next(function(err, doc) ***REMOVED***
 *     server.destroy();
 *   ***REMOVED***);
 * ***REMOVED***);
 *
 * // Start connecting
 * server.connect();
 */

/**
 * Creates a new Pool instance
 * @class
 * @param ***REMOVED***string***REMOVED*** preference A string describing the preference (primary|primaryPreferred|secondary|secondaryPreferred|nearest)
 * @param ***REMOVED***array***REMOVED*** tags The tags object
 * @param ***REMOVED***object***REMOVED*** [options] Additional read preference options
 * @param ***REMOVED***number***REMOVED*** [options.maxStalenessSeconds] Max Secondary Read Stalleness in Seconds, Minimum value is 90 seconds.
 * @property ***REMOVED***string***REMOVED*** preference The preference string (primary|primaryPreferred|secondary|secondaryPreferred|nearest)
 * @property ***REMOVED***array***REMOVED*** tags The tags object
 * @property ***REMOVED***object***REMOVED*** options Additional read preference options
 * @property ***REMOVED***number***REMOVED*** maxStalenessSeconds MaxStalenessSeconds value for the read preference
 * @return ***REMOVED***ReadPreference***REMOVED***
 */
var ReadPreference = function(preference, tags, options) ***REMOVED***
  this.preference = preference;
  this.tags = tags;
  this.options = options;

  // Add the maxStalenessSeconds value to the read Preference
  if(this.options && this.options.maxStalenessSeconds != null) ***REMOVED***
    this.options = options;
    this.maxStalenessSeconds = this.options.maxStalenessSeconds >= 0
      ? this.options.maxStalenessSeconds : null;
  ***REMOVED*** else if(tags && typeof tags == 'object') ***REMOVED***
    this.options = tags, tags = null;
  ***REMOVED***
***REMOVED***

/**
 * This needs slaveOk bit set
 * @method
 * @return ***REMOVED***boolean***REMOVED***
 */
ReadPreference.prototype.slaveOk = function() ***REMOVED***
  return needSlaveOk.indexOf(this.preference) != -1;
***REMOVED***

/**
 * Are the two read preference equal
 * @method
 * @return ***REMOVED***boolean***REMOVED***
 */
ReadPreference.prototype.equals = function(readPreference) ***REMOVED***
  return readPreference.preference == this.preference;
***REMOVED***

/**
 * Return JSON representation
 * @method
 * @return ***REMOVED***Object***REMOVED***
 */
ReadPreference.prototype.toJSON = function() ***REMOVED***
  var readPreference = ***REMOVED***mode: this.preference***REMOVED***;
  if(Array.isArray(this.tags)) readPreference.tags = this.tags;
  if(this.maxStalenessSeconds) readPreference.maxStalenessSeconds = this.maxStalenessSeconds;
  return readPreference;
***REMOVED***

/**
 * Primary read preference
 * @method
 * @return ***REMOVED***ReadPreference***REMOVED***
 */
ReadPreference.primary = new ReadPreference('primary');
/**
 * Primary Preferred read preference
 * @method
 * @return ***REMOVED***ReadPreference***REMOVED***
 */
ReadPreference.primaryPreferred = new ReadPreference('primaryPreferred');
/**
 * Secondary read preference
 * @method
 * @return ***REMOVED***ReadPreference***REMOVED***
 */
ReadPreference.secondary = new ReadPreference('secondary');
/**
 * Secondary Preferred read preference
 * @method
 * @return ***REMOVED***ReadPreference***REMOVED***
 */
ReadPreference.secondaryPreferred = new ReadPreference('secondaryPreferred');
/**
 * Nearest read preference
 * @method
 * @return ***REMOVED***ReadPreference***REMOVED***
 */
ReadPreference.nearest = new ReadPreference('nearest');

module.exports = ReadPreference;
